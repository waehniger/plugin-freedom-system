<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scatter UI Mockup v4 - Cream Spacey Textured</title>

  <style>
    /* CRITICAL: WebView constraints */
    html, body {
      height: 100%;  /* REQUIRED - replaces viewport units */
      margin: 0;
      padding: 0;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      /* Native application feel */
      user-select: none;
      -webkit-user-select: none;
      cursor: default;
      overflow: hidden;

      /* Styling - Black background for preview frame visibility */
      background: #000;
      color: #5a4a3a;
      font-family: 'Futura', 'Avenir', system-ui, sans-serif;

      /* Center preview frame */
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100%;
    }

    /* Fixed-size preview frame matching plugin spec */
    .plugin-frame {
      width: 550px;   /* FIXED - from YAML spec */
      height: 600px;  /* FIXED - from YAML spec */
      border: 2px solid #444;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      overflow: hidden;
      position: relative;
      background: #f5f0e8;  /* Warm cream base */
    }

    /* Plugin UI fills frame */
    .container {
      width: 100%;
      height: 100%;
      position: relative;

      /* Textured background */
      background:
        radial-gradient(ellipse at 50% 30%, rgba(255, 216, 155, 0.15), transparent 60%),
        linear-gradient(135deg, #f5f0e8 0%, #e8dfd0 100%);

      /* Grain texture overlay */
      background-image:
        radial-gradient(ellipse at 50% 30%, rgba(255, 216, 155, 0.15), transparent 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence baseFrequency="0.9" numOctaves="3" /></filter><rect width="200" height="200" filter="url(%23n)" opacity="0.08"/></svg>');
    }

    /* Header section */
    .header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      background: rgba(232, 223, 208, 0.6);
      backdrop-filter: blur(5px);
      border-bottom: 1px solid rgba(139, 115, 85, 0.2);
    }

    /* Combo box styling */
    .combo-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .combo-label {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      color: #8b7355;
      margin-bottom: 3px;
    }

    select {
      width: 200px;
      height: 28px;
      padding: 0 10px;
      font-size: 12px;
      font-family: 'Futura', 'Avenir', system-ui, sans-serif;
      color: #5a4a3a;
      background: #e8dfd0;
      border: 1px solid #b8956f;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;

      /* Skeuomorphic depth */
      box-shadow:
        inset 0 1px 3px rgba(0,0,0,0.1),
        0 1px 0 rgba(255,255,255,0.5);
    }

    select:hover {
      background: #d4c4a8;
    }

    select:focus {
      outline: none;
      border-color: #ffb347;
    }

    /* Particle field visualization */
    .particle-field {
      position: absolute;
      left: 175px;
      top: 150px;
      width: 200px;
      height: 200px;
      background:
        radial-gradient(circle at center, rgba(255, 216, 155, 0.3), rgba(232, 223, 208, 0.5) 60%, rgba(212, 196, 168, 0.8));
      border-radius: 12px;
      overflow: hidden;

      /* Skeuomorphic inset */
      box-shadow:
        inset 0 2px 8px rgba(0,0,0,0.15),
        inset 0 -1px 0 rgba(255,255,255,0.2),
        0 2px 4px rgba(139, 115, 85, 0.1);

      border: 1px solid rgba(139, 115, 85, 0.3);
    }

    .particle-field-label {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      color: rgba(90, 74, 58, 0.6);
    }

    /* Particles */
    .particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffb347, #ffd89b);
      box-shadow:
        0 0 8px rgba(255, 179, 71, 0.6),
        0 0 16px rgba(255, 216, 155, 0.3);
      animation: particle-float 3s ease-in-out infinite;
    }

    @keyframes particle-float {
      0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.8; }
      50% { transform: translate(var(--dx, 10px), var(--dy, 10px)) scale(1.2); opacity: 1; }
    }

    /* Knob container */
    .knob-container {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .knob-label {
      font-size: 11px;
      font-weight: 600;
      color: #5a4a3a;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .knob {
      position: relative;
      width: 90px;
      height: 90px;
      cursor: ns-resize;
    }

    /* Knob lighting layer (fixed) */
    .knob-lighting {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      pointer-events: none;
      z-index: 2;

      /* 3D lighting effect */
      box-shadow:
        inset -3px -3px 8px rgba(0,0,0,0.3),
        inset 3px 3px 8px rgba(255,255,255,0.6),
        0 4px 8px rgba(0,0,0,0.15);
    }

    /* Knob body (rotates) */
    .knob-body {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background:
        radial-gradient(circle at 35% 35%, #e8dfd0, #d4c4a8 50%, #b8956f);
      transform-origin: center center;
      transition: transform 50ms ease-out;
      z-index: 1;

      /* Textured surface */
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><filter id="n2"><feTurbulence baseFrequency="0.8" numOctaves="2" /></filter><rect width="100" height="100" filter="url(%23n2)" opacity="0.05"/></svg>');
      background-blend-mode: overlay;
    }

    /* Knob indicator */
    .knob-indicator {
      position: absolute;
      top: 8px;
      left: 50%;
      width: 3px;
      height: 25px;
      background: linear-gradient(to bottom, #5a4a3a, transparent);
      border-radius: 2px;
      transform: translateX(-50%);
    }

    /* Knob value display */
    .knob-value {
      margin-top: 6px;
      font-size: 11px;
      font-weight: 500;
      color: #8b7355;
      letter-spacing: 0.3px;
    }

    /* Debug monitor */
    .debug-monitor {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.85);
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      padding: 8px 12px;
      border: 1px solid #333;
      border-radius: 4px;
      min-width: 150px;
      pointer-events: none;
      z-index: 10000;
    }

    .debug-label {
      color: #666;
      font-size: 9px;
      margin-bottom: 4px;
      letter-spacing: 1px;
    }

    .debug-param {
      font-weight: bold;
      color: #0f0;
    }

    .debug-value {
      color: #fff;
      margin-top: 2px;
    }

    .debug-normalized {
      color: #888;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <div class="plugin-frame">
    <div class="container">
      <!-- Header with combo boxes -->
      <div class="header">
        <div class="combo-wrapper">
          <div class="combo-label">SCALE</div>
          <select id="scale">
            <option value="0">Chromatic</option>
            <option value="1">Major</option>
            <option value="2">Minor</option>
            <option value="3">Pentatonic</option>
            <option value="4">Blues</option>
          </select>
        </div>
        <div class="combo-wrapper">
          <div class="combo-label">ROOT</div>
          <select id="root_note">
            <option value="0">C</option>
            <option value="1">C#</option>
            <option value="2">D</option>
            <option value="3">D#</option>
            <option value="4">E</option>
            <option value="5">F</option>
            <option value="6">F#</option>
            <option value="7">G</option>
            <option value="8">G#</option>
            <option value="9">A</option>
            <option value="10">A#</option>
            <option value="11">B</option>
          </select>
        </div>
      </div>

      <!-- Particle field visualization -->
      <div class="particle-field" id="particleField">
        <div class="particle-field-label">GRAIN CLOUD</div>
        <!-- Particles generated by JavaScript -->
      </div>

      <!-- Knobs arranged in cluster around particle field -->

      <!-- Top left: Delay Time -->
      <div class="knob-container" style="left: 40px; top: 70px;">
        <div class="knob-label">Delay Time</div>
        <div class="knob" data-param="delay_time" data-min="100" data-max="2000" data-default="500" data-unit="ms">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">500 ms</div>
      </div>

      <!-- Top right: Grain Size -->
      <div class="knob-container" style="left: 420px; top: 70px;">
        <div class="knob-label">Grain Size</div>
        <div class="knob" data-param="grain_size" data-min="5" data-max="500" data-default="100" data-unit="ms">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">100 ms</div>
      </div>

      <!-- Middle left: Density -->
      <div class="knob-container" style="left: 40px; top: 375px;">
        <div class="knob-label">Density</div>
        <div class="knob" data-param="density" data-min="0" data-max="100" data-default="50" data-unit="%">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">50 %</div>
      </div>

      <!-- Middle right: Pitch Random -->
      <div class="knob-container" style="left: 420px; top: 375px;">
        <div class="knob-label">Pitch Random</div>
        <div class="knob" data-param="pitch_random" data-min="0" data-max="100" data-default="30" data-unit="%">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">30 %</div>
      </div>

      <!-- Bottom left: Pan Random -->
      <div class="knob-container" style="left: 80px; top: 475px;">
        <div class="knob-label">Pan Random</div>
        <div class="knob" data-param="pan_random" data-min="0" data-max="100" data-default="75" data-unit="%">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">75 %</div>
      </div>

      <!-- Bottom center: Feedback -->
      <div class="knob-container" style="left: 230px; top: 475px;">
        <div class="knob-label">Feedback</div>
        <div class="knob" data-param="feedback" data-min="0" data-max="100" data-default="30" data-unit="%">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">30 %</div>
      </div>

      <!-- Bottom right: Mix -->
      <div class="knob-container" style="left: 380px; top: 475px;">
        <div class="knob-label">Mix</div>
        <div class="knob" data-param="mix" data-min="0" data-max="100" data-default="50" data-unit="%">
          <div class="knob-lighting"></div>
          <div class="knob-body">
            <div class="knob-indicator"></div>
          </div>
        </div>
        <div class="knob-value">50 %</div>
      </div>
    </div>
  </div>

  <!-- Debug monitor -->
  <div class="debug-monitor">
    <div class="debug-label">PARAMETER MONITOR</div>
    <div class="debug-param" id="debugParam">—</div>
    <div class="debug-value" id="debugValue">—</div>
    <div class="debug-normalized" id="debugNormalized">—</div>
  </div>

  <script>
    // Mock JUCE backend for browser testing
    window.Juce = {
      getSliderState: (id) => ({
        normalisedValue: 0.5,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        },
        setNormalisedValue: (v) => console.log(`${id} set to ${v}`)
      }),
      getToggleState: (id) => ({
        value: false,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        }
      }),
      getComboBoxState: (id) => ({
        selectedId: 0,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        }
      })
    };

    // Disable context menu (REQUIRED)
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    // Update debug monitor
    function updateDebugMonitor(paramId, value, normalizedValue) {
      document.getElementById('debugParam').textContent = paramId;
      document.getElementById('debugValue').textContent = value;
      document.getElementById('debugNormalized').textContent = `${(normalizedValue * 100).toFixed(1)}%`;
    }

    // Initialize knobs
    document.addEventListener("DOMContentLoaded", () => {
      const knobs = document.querySelectorAll('.knob');

      knobs.forEach(knob => {
        const paramId = knob.dataset.param;
        const min = parseFloat(knob.dataset.min);
        const max = parseFloat(knob.dataset.max);
        const defaultVal = parseFloat(knob.dataset.default);
        const unit = knob.dataset.unit;

        const knobBody = knob.querySelector('.knob-body');
        const valueDisplay = knob.parentElement.querySelector('.knob-value');

        let currentValue = defaultVal;
        let isDragging = false;
        let startY = 0;
        let startValue = 0;

        // Set initial rotation
        const updateKnob = (value) => {
          currentValue = Math.max(min, Math.min(max, value));
          const normalized = (currentValue - min) / (max - min);
          const degrees = -135 + (normalized * 270);  // -135° to +135°

          knobBody.style.transform = `rotate(${degrees}deg)`;
          valueDisplay.textContent = `${Math.round(currentValue)} ${unit}`;

          updateDebugMonitor(paramId, `${Math.round(currentValue)} ${unit}`, normalized);
        };

        // Mouse events
        knob.addEventListener('mousedown', (e) => {
          isDragging = true;
          startY = e.clientY;
          startValue = currentValue;
          e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;

          const delta = startY - e.clientY;  // Inverted: up = increase
          const range = max - min;
          const sensitivity = range / 200;  // 200px drag = full range
          const newValue = startValue + (delta * sensitivity);

          updateKnob(newValue);
        });

        document.addEventListener('mouseup', () => {
          isDragging = false;
        });

        // Mouse wheel
        knob.addEventListener('wheel', (e) => {
          e.preventDefault();
          const delta = -e.deltaY;  // Inverted: scroll up = increase
          const range = max - min;
          const sensitivity = range / 100;

          updateKnob(currentValue + (delta * sensitivity * 0.5));
        });

        // Initialize
        updateKnob(defaultVal);
      });

      // Combo boxes
      document.getElementById('scale').addEventListener('change', (e) => {
        const scaleNames = ['Chromatic', 'Major', 'Minor', 'Pentatonic', 'Blues'];
        updateDebugMonitor('scale', scaleNames[e.target.value], parseFloat(e.target.value) / 4);
      });

      document.getElementById('root_note').addEventListener('change', (e) => {
        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        updateDebugMonitor('root_note', noteNames[e.target.value], parseFloat(e.target.value) / 11);
      });

      // Particle animation
      const particleField = document.getElementById('particleField');
      const particleCount = 20;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';

        // Random position
        const x = Math.random() * 180 + 10;
        const y = Math.random() * 180 + 10;
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;

        // Random animation offset
        particle.style.animationDelay = `${Math.random() * 3}s`;
        particle.style.setProperty('--dx', `${(Math.random() - 0.5) * 20}px`);
        particle.style.setProperty('--dy', `${(Math.random() - 0.5) * 20}px`);

        // Random size variation
        const scale = 0.6 + Math.random() * 0.8;
        particle.style.transform = `scale(${scale})`;

        particleField.appendChild(particle);
      }
    });
  </script>
</body>
</html>
